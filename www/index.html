<!DOCTYPE html>
<!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1">
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src *;
style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe eval'"> -->
    <title>diapixUK</title>

    <link href="lib/ionic/css/ionic.min.css" rel="stylesheet">
    <link href="css/style.min.css" rel="stylesheet">

    <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
    <link href="css/ionic.app.css" rel="stylesheet">
    -->

    <!-- ionic/angularjs js -->


    <!-- cordova script (this will be a 404 during development) -->
    <!-- <script src="cordova.js"></script> -->

    <!-- your app's js -->

    <!-- <meta charset="utf-8"> -->
    <script src="lib/ionic/js/ionic.bundle.js"></script>
    <!-- <script src="lib/fastclick.js"></script> -->
    <script src="js/jquery-1.12.1.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <!-- <script src="js/ng-cordova.js"></script> -->
    <!-- <script src="js/pouchdb-5.3.1.min.js"></script> -->
    <!-- <script src="js/socket.io.js"></script> -->
    <script src="https://diapixuk.herokuapp.com/socket.io/socket.io.js"></script> <!--ATTN - I think this concerns getting the data out-->
    <script type="text/javascript" src="js/validator.min.js"></script>
    <script src="js/main.js"></script> <!--where the session code is at -->
    <script src="js/app.js"></script> <!--look here too-->
    <script src="js/socket.js"></script> <!--and here this actually transmits data to a log
    maybe I should incorporate my bit in here - or replace my this with my bit-->
    <script src="js/googlesheets.js"></script>
  </head>

  </head>

  <body>
<!--NEW SCREEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEN-->
    <div id="startScreen" class="screen">
      <script type="text/javascript">
        handleClientLoad();
      </script>
      <center class="startVCenter">
        <h1 class="royal special">diapixUK</h1>
        <p class="royal instructions" align="justify">
            To store a record of this session with Google Sheets, please login:</p>
        <button id="authorize-button" class="button button-full button-royal" style="height:50px;display: none;">Authorize</button>
        <button id="signout-button" class="button button-full button-royal" style="height:50px;display: none;">Sign Out</button>
        <p class="royal instructions" align="justify">
            The diapixUK is a dialogue elicitation technique for research, and a set of materials developed by Baker and Hazan (2011) and based on the Diapix task of van Engen et al (2010).
            <span class="readLess royal">
                <br>
                It consists of 12 ‘spot the difference’ picture tasks that have to be solved cooperatively by pairs of participants who are not able to see each other.
                <br>
                For more information, please visit <a href="https://github.com/diapixUK/diapixUK" target="_blank">github.com/diapixUK</a>.
                <p class="readLess royal"><strong>Hide this text.</strong></p>
            </span>
            <p id="readMore" class="royal"><strong>Read More</strong></p>
        </p>
            <br>
            <!-- call to main.js follows; updateWindow() moves on to the next
          screen, subject to some if-checks, making sure that required fields are
          filled, etc-->
            <a id="makesheet" class="button button-full button-royal" style="height:50px;" on-tap="createSpreadsheet();"  onclick="createSpreadsheet();" >
              Create spreadsheet
            </a>
              <a id="deviceready" class="button button-full button-royal" style="height:50px;" on-tap="updateWindow('startScreen','secondScreen');"  onclick="updateWindow('startScreen','secondScreen');" >
                start
              </a>
        </center>
    </div>

    <div id="secondScreen" class="screen" style="display: none;">
      <div class="bar bar-header bar-royal">
        <h1 class="title">Researchers: Pair Details</h1>
      </div>
      <div class="list list-inset inscreen">
        <center class="vcenter">
            <h4 class="royal" align="justify">For researchers, set up the leader tablet below, then pair another tablet to the same room.</h4>
          <div class="item item-toggle">
                <div align="left">
                  Is this the host (leader) tablet?
                </div>
                <!-- call to main.js follows; sortPairing(); this determines whether the tablet
              to hand is the lead or subordinate tablet, which affects the
              subsequent behaviour of the JS-->
                <label class="toggle toggle-royal" on-tap="sortPairing();" onclick="sortPairing();">
                  <input id="host" name="host" checked="checked" type="checkbox" style="-webkit-filter: blur(0.000001px)">
                  <div class="track">
                    <div class="handle"></div>
                  </div>
                </label>
            </div>
        <div class="pairCodes option1">
          <label class="item item-input">
            <input id="subjCode1" type="text" placeholder="Please input subject 1 code">
          </label>
          <label class="item item-input">
            <input id="subjCode2" type="text" placeholder="Please input subject 2 code">
          </label>
        </div>
        <div class="item item-toggle option1">
          <div align="left">
            Show timer?
          </div>
          <label class="toggle toggle-royal">
            <input id="showTimer" name="time" checked="checked" type="checkbox" style="-webkit-filter: blur(0.000001px)">
            <div class="track">
              <div class="handle"></div>
            </div>
          </label>
        </div>
        <!-- <div class="item item-toggle">
          <div align="left">
            Recording (N/A)
          </div>
          <label class="toggle toggle-royal">
            <input id="recorder" name="record" type="checkbox" style="-webkit-filter: blur(0.000001px)">
            <div class="track">
              <div class="handle"></div>
            </div>
          </label>
        </div> -->
        <div class="item block option1" style="padding: 0">
          <div class="range range-royal chooseTime" style="padding-left: 16px">
            Time
            <!-- call to main.js follows; updateSlideText();  This just changes
          the text next to the slider for the duration of the task to reflect
        how long the task will be for that slider position-->
            <input id="timeVal" type="range" name="time" min="1" max="15" value="10" oninput="updateSlideText(this.value);">
            <div style="width: 80px">
              <center id="timevalue">10 minutes</center>
            </div>
          </div>
        </div>
        <label class="item item-input item-select option1" style="height:50px">
          <select id="picture" style="left: 0%; direction: ltr; font-size: 16px; color: rgb(68, 68, 68)">
            <option value="empty">Select a picture</option>
            <option value="img/beach1">Beach 1</option>
            <option value="img/beach2">Beach 2</option>
            <option value="img/beach3">Beach 3</option>
            <option value="img/beach4">Beach 4</option>
            <option value="img/farm1">Farm 1</option>
            <option value="img/farm2">Farm 2</option>
            <option value="img/farm3">Farm 3</option>
            <option value="img/farm4">Farm 4</option>
            <option value="img/park">Park</option>
            <option value="img/street1">Street 1</option>
            <option value="img/street2">Street 2</option>
            <option value="img/street3">Street 3</option>
            <option value="img/street4">Street 4</option>
          </select>
        </label>
        <label class="item item-input item-select chooseRoom" style="height:50px">
            <select id="rooms" style="left: 0%; direction: ltr; font-size: 16px; color: rgb(68, 68, 68); max-width:100%;">
                <option id="testOption" value="null">Loading Available Rooms. Please hold...</option>
            </select>
        </label>
        </center>
      </div>
      <!-- call to main.js follows - move on with updateWindow-->
      <!-- call to socket.js, keep(), which collects data and sends it to socket-->
          <a class="button icon-right ion-chevron-right button-royal buttonPosRight" on-tap="updateWindow('secondScreen','thirdScreen');keep();" onclick="updateWindow('secondScreen','thirdScreen'); keep();">
            Next
          </a>
          <a class="button icon-left ion-chevron-left button-royal buttonPosLeft" on-tap="updateWindow('secondScreen','startScreen')" onclick="updateWindow('secondScreen','startScreen')">
            Back
          </a>
    </div>
<!--NEW SCREEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEN-->
    <div id="thirdScreen" class="screen" style="display: none;">
      <div class="bar bar-header bar-royal">
        <h1 class="title">Researchers: Player Details</h1>
      </div>

      <div class="list list-inset inscreen">
        <center class="vcenter">
            <h4 class="royal" align="justify">Input subject details and pass tablet to player after clicking 'Next'.</h4>
          <label class="item item-select">
              <select id="subjCode" style="left: 0%; direction: ltr; font-size: 16px; color: #aaaaaa" onchange="subColor()">
                <option value="0">Choose the Subject Code for this tablet</option>
                <option id="reflect1">Subject 1</option>
                <option id="reflect2">Subject 2</option>
              </select>
          </label>
          <label class="item item-input">
            <input id="age" type="text" placeholder="Age (optional)">
          </label>
          <label class="item item-input item-select">
            <select id="gender" style="left: 0%; direction: ltr; font-size: 16px; color: #aaaaaa" onchange="genderColor()">
              <option value="0">Subject Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option> <!--Extra option for trans inclusivity, added by Dave C-->
            </select>
          </label>
          <label class="item item-input">
            <input id="conditions" type="text" placeholder="Conditions (optional)">
          </label>
        </center>
      </div>
      <!-- call to main.js follows, updateWindow-->
          <a class="button icon-right ion-chevron-right button-royal buttonPosRight" on-tap="updateWindow('thirdScreen','fourthScreen');addToStore();" onclick="updateWindow('thirdScreen','fourthScreen');addToStore();">
            Next
          </a>
          <a class="button icon-left ion-chevron-left button-royal buttonPosLeft" on-tap="updateWindow('thirdScreen','secondScreen')" onclick="updateWindow('thirdScreen','secondScreen')">
            Back
          </a>
    </div>

<!--NEW SCREEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEN-->
    <div id="fourthScreen" class="screen" style="display: none">
      <div class="bar bar-header bar-royal">
        <h1 class="title">Welcome to Diapix!</h1>
      </div>

      <div class="list list-inset inscreen">
          <center class="vcenter royal instructions" align="justify">
              <!-- <ul> -->
                  <h4 class="royal">You and your partner have been given two different versions of the same scene.</h4>
                  <h4 class="royal">You are both given <span id="userTime">10 minutes</span> to find 12 differences between the two pictures.</h4>
                  <h4 class="royal">Each time you spot a difference, just tap on the screen and a circle will be drawn on the difference.</h4>
                  <h4 class="royal">An example is below:</h4>
              <!-- </ul> -->
              <div class="row examples">
                  <center class="col"><img src="img/egdiff1.png"></center>
                  <center class="col"><img src="img/egdiff2.jpg"></center>
              </div>
          </center>
      </div>
      <!-- call to main.js follows, updateWindow-->
      <a class="button icon-right ion-chevron-right button-royal buttonPosRight" on-tap="updateWindow('fourthScreen','fifthScreen');" onclick="updateWindow('fourthScreen','fifthScreen');">
        Next
      </a>
      <!-- call to main.js follows, updateWindow-->
      <a class="button icon-left ion-chevron-left button-royal buttonPosLeft" on-tap="updateWindow('fourthScreen','thirdScreen');" onclick="updateWindow('fourthScreen','thirdScreen');">
        Back
      </a>
    </div>
<!--NEW SCREEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEN-->
    <div id="fifthScreen" class="screen" style="display: none">
      <div class="bar bar-header bar-royal">
        <h1 class="title">More Instructions</h1>
      </div>

        <center class="vcenter royal instructions" align="justify">
            <!-- <ul> -->
                <h4 class="royal">Try to find all 12 differences before your time is up.</h4>
                <h4 class="royal">Start your picture description from the top left-hand corner and carry on clockwise.</h4>
                <h4 class="royal">You can remove differences by tapping them again. The circle will turn orange and you will be asked to confirm your choice, like below:</h4>
            <!-- </ul> -->
            <div class="row examples">
                <center class="col"><img src="img/diff.png"></center>
            </div>
            <h3 class="royal" align="center">
                    When you're ready to play, press start!
            <h3 align="center">
        </center>
        <!-- call to main.js follows:
      startTimer(); shows timer if showTimer element is checked - then sets timer
        and starts setInterval call running, which calls updateTimer once per second
      updateWindow(); You know...
      canv(); Sets up varibles needed for recording Diapix task-->
      <a class="button icon-right ion-chevron-right button-royal buttonPosRight" on-tap="startTimer(); updateWindow('fifthScreen','sixthScreen'); canv();" onclick="startTimer(); updateWindow('fifthScreen','sixthScreen'); canv();">
      <!-- <a class="button icon-right ion-chevron-right button-royal buttonPosRight" onclick="startTimer();recordAudio(); updateWindow('fourthScreen','fifthScreen'); canv();"> -->
        Start
      </a>
      <!-- call to main.js follows - uses updateWindow to go back one-->
      <a class="button icon-left ion-chevron-left button-royal buttonPosLeft" on-tap="updateWindow('fifthScreen','fourthScreen');" onclick="updateWindow('fifthScreen','fourthScreen');">
        Back
      </a>
    </div>
<!--NEW SCREEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEN-->
<!-- This screen here is the actual diapix task -->
    <div id="sixthScreen" class="screen row" style="display: none; padding: 0px; setKeepScreenOn(true)">
      <div class="outsideWrapper">
        <div class="insideWrapper">
            <img id="img" src="" class="coveredImage">
            <!-- call to main.js follows-->
            <canvas id="imgCanvas" class="coveringCanvas" on-click="handleEvent(event);" onclick="handleEvent(event);"></canvas>
        </div>
      </div>
      <div id="timerDiv" class="rightTimer">
          <div id="timer" class="royal" style="padding-bottom: 5vh; font-size: 5vw"></div>
          <center>
            <!-- call to main.js follows
              pauseTimer(); does what it says, by -->
          <a id="pauseButton" class="button button-large button-energized" on-tap="pauseTimer(); showResume();" onclick="pauseTimer(); showResume();">
              Pause
          </a>
          <!-- call to main.js follows-->
          <a id="resumeButton" class="button button-large button-energized" style="display: none" on-tap="resumeTimer(); showPause();" onclick="resumeTimer(); showPause();">
              Resume
          </a>
        </center>
      </div>
      <div id="resultDiv" class="rightTimer" style="display: none">
      	<center id="result" class="royal" style="font-size: 2vw; font-weight: bold; width: 20vw"></center>
      </div>
      <!-- call to main.js follows-->
      <a class="button icon-left ion-chevron-left button-assertive buttonQuit" on-tap="updateWindow('sixthScreen','fifthScreen'); pauseTimer();" onclick="updateWindow('sixthScreen','fifthScreen'); pauseTimer();">
            Quit
        </a>
        <!-- call to main.js follows-->
        <a id="finishButton" class="button icon-right ion-chevron-right button-royal buttonFinish" on-tap="confirmFinish();" onclick="confirmFinish();">
<!-- addToDo(document.getElementById('subjCode').value,document.getElementById('age').value,document.getElementById('gender').value,document.getElementById('conditions').value,document.getElementById('recorder').value,document.getElementById('timeValue').value,document.getElementById('showTimer').value,document.getElementById('picture').value) -->
            Finish
        </a>
        <a id="submitButton" class="button icon-right ion-chevron-right button-royal buttonFinish" style="display: none;" on-tap="updateWindow('sixthScreen', 'seventhScreen'); addResults();" onclick="updateWindow('sixthScreen', 'seventhScreen'); addResults();">
            Submit
        </a>
    </div>

<!--NEW SCREEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEN-->
    <div id="seventhScreen" class="screen" style="display: none">

      <center class="startVCenter">
        <h1 class="royal" style="font-size: 5vw;">Thanks for playing Diapix!</h1>
        <br>
        <a href="index.html" class="button button-large button-royal">
          Play again
        </a>
      </center>
    </div>


	<div id="popup" class="modal">
	  <div class="modal-content modcenter">
	 	<center>
	    	<p id="err" class="royal"></p>
	    	<a id="closeModal" class="button button-royal" on-tap="closeModal();" onclick="closeModal();">
	    		Close
	    	</a>
	    	<div id="confirmButtons" class="row" style="width: 70%; display: none">
			   	<div style="width: 50%">
			   		<center>
						<a class="button button-royal" on-tap="confirmPopup();" onclick="confirmPopup();">
							Confirm
						</a>
					</center>
				</div>
				<div style="width: 50%">
					<center>
						<a class="button button-royal" on-tap="closeModal(); popupCloseEvent = 0;" onclick="closeModal(); popupCloseEvent = 0;">
							Cancel
						</a>
					</center>
				</div>
			</div>
	    </center>
	  </div>
	</div>

	<div id="popup2" class="modal" style="background-color: transparent;">
	  <div id="popupContainer" class="modal-content" style="position: absolute; height: 20vh; width: 32vw; padding: 0; padding-top: 2vh">
	 	<center>
	    	<p class="royal">Remove this difference?</p>
		    <div class="row" style="width: 80%">
			   	<div style="width: 50%">
			   		<center>
						<a class="button button-royal" on-tap="confirmPopup();" onclick="confirmPopup();">
							Confirm
						</a>
					</center>
				</div>
				<div style="width: 50%">
					<center>
						<a class="button button-royal" on-tap="closeModal(); popupCloseEvent = 0; draw();" onclick="closeModal(); popupCloseEvent = 0; draw();">
							Cancel
						</a>
					</center>
				</div>
			</div>
		</center>
	  </div>
	</div>
  <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
  </body>
</html>
